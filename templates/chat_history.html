{% if chat_history %}
<div class="chat-history">
    <h2>Conversation History</h2>
    
    {% for message in chat_history|reverse %}
    <div class="chat-message" data-message-index="{{ loop.index0 }}">
        <div class="user-message">
            <strong>You:</strong> {{ message.prompt }}
        </div>
        
        <div class="ai-response">
            <strong>AI:</strong>
            
            {% if message.text_response %}
            <div class="response-text">{{ message.text_response }}</div>
            {% endif %}
            
            <div class="image-container">
                <img src="/{{ message.image_path }}" alt="Generated image">
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                </div>
                <div class="action-buttons">
                    <a href="{{ url_for('download_file', filename=message.download_name) }}" class="button-download">Download Image</a>
                    {% if not loop.last %}
                    <button type="button" class="button-regenerate" data-prompt="{{ message.prompt }}" data-index="{{ loop.index0 }}">Regenerate</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}